<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:dita="http://dita.oasis-open.org/architecture/2005/" xmlns:case="http://www.lexis-nexis.com/glp/case"
	xmlns:docinfo="http://www.lexis-nexis.com/glp/docinfo"
	xmlns:doc="http://www.lexisnexis.com/xmlschemas/content/shared/document-level-metadata/1/"
	xmlns:jurisinfo="http://www.lexisnexis.com/xmlschemas/content/legal/jurisdiction-info/1/" version="2.0"
	exclude-result-prefixes="dita case docinfo">

	<dita:topic xmlns="http://dita.oasis-open.org/architecture/2005/" id="Rosetta_case.courtcode">
		<title>case:courtcode <lnpid>id-CCCC-12011</lnpid></title>
		<body>
			<section>
				<p><sourcexml>case:courtcode</sourcexml> is mapped to the target: <ul>
						<li><targetxml>jurisinfo:courtinfo/jurisinfo:alternatecourtcode/@alternatecourtcode</targetxml></li>
						<li><targetxml>doc:metadata/doc:docinfo/doc:legacy-metadata[metadatasource="lbu-meta"]/meta/metaitem</targetxml>.
							The attributes of <targetxml>metaitem</targetxml> are populated as follows: <ul>
								<li><targetxml>metaitem/@name</targetxml> should be set to "case:courtcode".</li>
								<li><targetxml>metaitem/@value</targetxml> should be set to the value of
										<sourcexml>case:courtcode</sourcexml>.</li>
							</ul></li>
					</ul></p>

				<p>
					<b>For Canada Specific only</b>
				</p>
				<p><sourcexml>case:courtcode</sourcexml> becomes
						<targetxml>doc:metadata/doc:docinfo/doc:legacy-metadata[metadatasource="lbu-meta"]/meta/metaitem</targetxml>.
					The attributes of <targetxml>metaitem</targetxml> are populated as follows:</p>
				<ul>
					<li><targetxml>metaitem/@name</targetxml> should be set to "case:courtcode".</li>
					<li><targetxml>metaitem/@value</targetxml> should be set to the value of
						<sourcexml>case:courtcode</sourcexml>.</li>
				</ul>
			</section>
			<example>
				<title>Example: CA content</title>
				<codeblock> &lt;case:courtcode ln.user-displayed="false"&gt;NSSC&lt;/case:courtcode&gt; </codeblock>
				<b>becomes</b>
				<codeblock> &lt;doc:metadata&gt; &lt;doc:docinfo doc-content-country="CA"&gt; ... &lt;doc:legacy-metadata
					metadatasource="lbu-meta"&gt; &lt;meta&gt; ... &lt;metaitem name="case:courtcode" value="NSSC"/&gt;
					&lt;/meta&gt; &lt;/doc:legacy-metadata&gt; &lt;/doc:docinfo&gt; &lt;/doc:metadata&gt; </codeblock>
			</example>
			<example>
				<title>Example: AU content</title>
				<codeblock> &lt;case:courtinfo&gt; &lt;case:courtcode&gt;FCA&lt;/case:courtcode&gt; ... &lt;/case:courtinfo&gt; </codeblock>
				<b>becomes</b>
				<codeblock> &lt;jurisinfo:courtinfo&gt; &lt;jurisinfo:alternatecourtcode alternatecourtcode="FCA" /&gt;
					&lt;/jurisinfo:courtinfo&gt; ... &lt;doc:legacy-metadata metadatasource="lbu-meta"&gt; &lt;meta&gt;
					&lt;metaitem name="case:courtcode" value="FCA"&gt;  &lt;/meta&gt; &lt;/doc:legacy-metadata&gt; </codeblock>
			</example>
			<example>
				<title>Example: NZ content</title>
				<codeblock> &lt;case:courtinfo&gt; &lt;case:courtcode&gt;NZCA&lt;/case:courtcode&gt; ... &lt;/case:courtinfo&gt; </codeblock>
				<b>becomes</b>
				<codeblock> &lt;jurisinfo:courtinfo&gt; &lt;jurisinfo:alternatecourtcode alternatecourtcode="NZCA" /&gt;
					&lt;/jurisinfo:courtinfo&gt; &lt;doc:legacy-metadata metadatasource="lbu-meta"&gt; &lt;meta&gt; &lt;metaitem
					name="case:courtcode" value="NZCA"&gt;  &lt;/meta&gt; &lt;/doc:legacy-metadata&gt; </codeblock>
			</example>
			<example>
				<title>Example: UK content</title>
				<codeblock> &lt;case:courtcode&gt;CA&lt;/case:courtcode&gt; </codeblock>
				<b>becomes</b>
				<codeblock> &lt;jurisinfo:courtinfo&gt; &lt;jurisinfo:alternatecourtcode alternatecourtcode="CA"/&gt;
					&lt;/jurisinfo:courtinfo&gt; ... &lt;doc:metadata&gt; &lt;doc:docinfo doc-content-country="GB"&gt; ...
					&lt;doc:legacy-metadata metadatasource="lbu-meta"&gt; &lt;meta&gt; ... &lt;metaitem name="case:courtcode"
					value="CA"/&gt; &lt;/meta&gt; &lt;/doc:legacy-metadata&gt; &lt;/doc:docinfo&gt; &lt;/doc:metadata&gt;
				</codeblock>
			</example>
			<section>
				<title>Changes</title>
				<p>2014-11-11: <ph id="change_20141111_PS">Created separate rule of <sourcexml>case:courtcode</sourcexml> for
						Canada specific.</ph></p>
			</section>
		</body>
	</dita:topic>

	<!--  @@@ This file has been autogenerated.  Remove this comment after manual development complete! @@@  -->
	<!--    Original DITA file location:  DITA\ConversionInstructions\Rosetta\common_caselaw\Rosetta_case.courtcode.dita  -->


	<xsl:template match="case:courtcode[not($streamID = ('NZ03', 'AU09'))]">

		<!--  Original Target XPath:  jurisinfo:courtinfo/jurisinfo:alternatecourtcode/@alternatecourtcode   -->
		<!-- Awantika: 2017-10-30- Updated for AU01 where colon (:) was coming between case:courtcode and case:judges which was coming inside caseinfo:caseinfo
		which caused validation error-->
		<jurisinfo:alternatecourtcode>
			<xsl:attribute name="alternatecourtcode">
				<xsl:choose>
					<xsl:when test="$streamID = 'CA01'">
						<xsl:value-of select="following-sibling::abbrvname"/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:apply-templates select="@* | node()"/>
						<xsl:if test="normalize-space(following-sibling::text()[1]) = ':' and $streamID='AU01'">
							<xsl:value-of select="following-sibling::text()[1]"></xsl:value-of>
						</xsl:if>
						
					</xsl:otherwise>
				</xsl:choose>
			</xsl:attribute>
		</jurisinfo:alternatecourtcode>
	</xsl:template>
	
	<!-- Awantika: 2017-10-30- Updated for AU01 where colon (:) was coming between case:courtcode and case:judges which was coming inside caseinfo:caseinfo
		which caused validation error-->
	<xsl:template match="text()[preceding-sibling::*[1][local-name()='courtcode']][normalize-space(.)=':'][$streamID='AU01']">
		
	</xsl:template>

	<!--Satbir: Created separate template for NZ03 because case:courtcode comes double times single input-->
	<xsl:template match="case:courtcode[$streamID = ('NZ03', 'AU09')]">
		<xsl:choose>
			<xsl:when test="not(following-sibling::case:courtcode)">
				<jurisinfo:alternatecourtcode>
					<xsl:attribute name="alternatecourtcode">
						<xsl:value-of select="//case:courtcode[last()]"/>
					</xsl:attribute>
				</jurisinfo:alternatecourtcode>
			</xsl:when>
			<xsl:otherwise>
				<xsl:apply-templates select="@* | node() except text()"/>
			</xsl:otherwise>
		</xsl:choose>
	</xsl:template>

</xsl:stylesheet>
