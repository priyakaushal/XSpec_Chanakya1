<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:dita="http://dita.oasis-open.org/architecture/2005/" 
  xmlns:case="http://www.lexis-nexis.com/glp/case" xmlns:compcase="urn:x-lexisnexis:content:compositecourtcase:sharedservices:1" 
  xmlns:jurisinfo="http://www.lexisnexis.com/xmlschemas/content/legal/jurisdiction-info/1/"
  xmlns:location="http://www.lexisnexis.com/xmlschemas/content/shared/location/1/"
  xmlns="http://www.lexisnexis.com/xmlschemas/content/shared/base/1/"
  version="2.0" exclude-result-prefixes="dita case">

	<dita:topic xmlns="http://dita.oasis-open.org/architecture/2005/" id="case.info">
  <title>case:info <lnpid>id-AU13-20434</lnpid></title>
  <body>
    <section>
      <ul>
        <li>
          <sourcexml>case:info</sourcexml> becomes <targetxml>compcase:caseinfo</targetxml>
          <pre xml:space="preserve">

&lt;case:info&gt;
  ...
  &lt;case:casename&gt; Hurrey v Bank of New South Wales&lt;/case:casename&gt;
  ...
&lt;/case:info&gt;

<b>Becomes</b>

&lt;compcase:caseinfo&gt;
  ...
  &lt;caseinfo:casename&gt;
    &lt;caseinfo:fullcasename&gt; Hurrey v Bank of New South Wales&lt;/caseinfo:fullcasename&gt;
  &lt;/caseinfo:casename&gt;
  ...
&lt;/compcase:caseinfo&gt;

</pre>
        </li>
      </ul>
    </section>
  </body>
	</dita:topic>

	<!--  @@@ This file has been autogenerated.  Remove this comment after manual development complete! @@@  -->
	<!--    Original DITA file location:  DITA\ConversionInstructions\Rosetta\DITA-PAC\AU13_composite_cases\case.info.dita  -->
	 

	<xsl:template match="case:info">

		<!--  Original Target XPath:  compcase:caseinfo   -->
		<compcase:caseinfo>
			<xsl:apply-templates select="@* | node() except (case:courtinfo | case:dates | fnr[preceding-sibling::*[1][self::case:casename]])"/>
		</compcase:caseinfo>
	  
		<xsl:for-each-group select="case:courtinfo/*" group-starting-with="case:courtname">
	  					<xsl:choose>
	  						<xsl:when test="current-group()/self::case:juris[not(preceding-sibling::*)]"/>
	  						<xsl:otherwise>
	  							<compcase:caseinstanceinfo>
	  								<jurisinfo:courtinfo>
	  									<xsl:apply-templates select="current-group()/self::case:courtcode"/>
	  									<xsl:apply-templates select="current-group()/self::case:courtname"/>
	  									<xsl:apply-templates select="current-group()/self::case:courtloc"/>
	  									<xsl:choose>
	  										<xsl:when test="current-group()/self::case:juris and not(current-group()/preceding-sibling::*[1][(self::case:courtloc)])">
	  											<jurisinfo:jurisdiction>
	  												<xsl:apply-templates select="current-group()/self::case:juris"/>
	  											</jurisinfo:jurisdiction>
	  										</xsl:when>
	  										<xsl:when test="current-group()[not(self::case:juris)] and preceding-sibling::*[1][self::case:juris]">
	  											<xsl:apply-templates select="preceding-sibling::*[1][self::case:juris]"/>	  										
	  										</xsl:when>
	  										<xsl:when test="current-group()/self::case:courtcode[not(following-sibling::*[self::case:juris]) and 
	  											following-sibling::node()[1][not(self::*)] and not(matches(following-sibling::node()[1], ': '))]">
	  											<jurisinfo:jurisdiction>
	  												<jurisinfo:location>
	  													<xsl:analyze-string select="current-group()/self::case:courtcode/following-sibling::text()[1]" regex="^,\s(.*)$">
	  														<xsl:matching-substring>
	  															<connector>,</connector>
	  															<location:city>
	  																<xsl:value-of select="normalize-space(regex-group(1))"/>
	  															</location:city>
	  														</xsl:matching-substring>
	  														<xsl:non-matching-substring>
	  															<location:city>
	  																<xsl:value-of select="normalize-space(.)"/>
	  															</location:city>
	  														</xsl:non-matching-substring>
	  													</xsl:analyze-string>
	  												</jurisinfo:location>
	  											</jurisinfo:jurisdiction>
	  										</xsl:when>
	  										<xsl:otherwise/>
	  									</xsl:choose>
	  								</jurisinfo:courtinfo>
	  								<xsl:apply-templates select="current-group()/self::case:dates|current-group()/self::case:judges|current-group()/self::case:filenum|
	  									current-group()/self::case:courtcite"/>
	  							</compcase:caseinstanceinfo>
	  						</xsl:otherwise>
	  					</xsl:choose>
		</xsl:for-each-group>
	  

	</xsl:template>

</xsl:stylesheet>