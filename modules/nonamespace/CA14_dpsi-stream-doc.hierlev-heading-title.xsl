<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:dita="http://dita.oasis-open.org/architecture/2005/"
    xmlns:docinfo="http://www.lexis-nexis.com/glp/docinfo"
    xmlns:doc="http://www.lexisnexis.com/xmlschemas/content/shared/document-level-metadata/1/"
    xmlns="http://www.lexisnexis.com/xmlschemas/content/shared/base/1/"
    version="2.0" exclude-result-prefixes="dita">

    <dita:topic xmlns="http://dita.oasis-open.org/architecture/2005/"
        id="CA14_dpsi-stream-doc.hierlev-heading-title">
        <title>docinfo:custom-metafield/@name="dpsi" <lnpid>id-CA14-35636</lnpid></title>
        <body>
            <section>
                <p>Using DPSI values from the manifest file and conversion should generate first top
                    level <targetxml>doc:hierlev</targetxml> with the colum value '<b>TOC top
                        line</b>', please refer below example for better understanding.</p>
                <table>
                    <tgroup cols="2">
                        <thead>
                            <row>
                                <entry>DPSI</entry>
                                <entry>TOC top line</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>0U90</entry>
                                <entry>What's New</entry>
                            </row>
                            <row>
                                <entry>0U93</entry>
                                <entry>Canadian Securities Law News NewsLetter</entry>
                            </row>
                            <row>
                                <entry>0U97</entry>
                                <entry>What’s New</entry>
                            </row>
                            <row>
                                <entry>0U9I</entry>
                                <entry>What’s New</entry>
                            </row>
                            <row>
                                <entry>0U9J</entry>
                                <entry>Health Law Matters NewsLetter</entry>
                            </row>
                            <row>
                                <entry>0U9K</entry>
                                <entry>What’s New</entry>
                            </row>
                            <row>
                                <entry>0U9N</entry>
                                <entry>Commercial Times NewsLetter</entry>
                            </row>
                            <row>
                                <entry>0UA1</entry>
                                <entry>Canadian Family Law Matters NewsLetter </entry>
                            </row>
                            <row>
                                <entry>0UAB</entry>
                                <entry>What’s New</entry>
                            </row>
                            <row>
                                <entry>0UAM</entry>
                                <entry>Canada Corporate Brief - NewsLetter</entry>
                            </row>
                            <row>
                                <entry>0UAU</entry>
                                <entry>Labour Law Cases What's New</entry>
                            </row>
                            <row>
                                <entry>0UAX</entry>
                                <entry>Employment Standards What's New</entry>
                            </row>
                            <row>
                                <entry>0UAZ</entry>
                                <entry>Employment Insurance What's New</entry>
                            </row>
                            <row>
                                <entry>0UB0</entry>
                                <entry>What's New</entry>
                            </row>
                            <row>
                                <entry>0UB2</entry>
                                <entry>What’s New</entry>
                            </row>
                            <row>
                                <entry>0UB3</entry>
                                <entry>Corporate Law NewsTracker</entry>
                            </row>
                            <row>
                                <entry>0UB4</entry>
                                <entry>Commercial Law NewsTracker</entry>
                            </row>
                            <row>
                                <entry>0UB5</entry>
                                <entry>Real Estate Law NewsTracker</entry>
                            </row>
                            <row>
                                <entry>0UB6</entry>
                                <entry>NewsLetter</entry>
                            </row>
                            <row>
                                <entry>0UB7</entry>
                                <entry>NewsLetter</entry>
                            </row>
                            <row>
                                <entry>0UB8</entry>
                                <entry>What’s New</entry>
                            </row>
                            <row>
                                <entry>0UBB</entry>
                                <entry>BC Real Estate Law Developments NewsLetter</entry>
                            </row>
                            <row>
                                <entry>0UBC</entry>
                                <entry>Labour Notes Newsletter</entry>
                            </row>
                            <row>
                                <entry>0UBD</entry>
                                <entry>NewsTracker</entry>
                            </row>
                            <row>
                                <entry>0UBE</entry>
                                <entry>Ontario Real Estate Law Developments NewsLetter</entry>
                            </row>
                            <row>
                                <entry>0UBG</entry>
                                <entry>Newsletter</entry>
                            </row>
                            <row>
                                <entry>0UBH</entry>
                                <entry>NewsLetter</entry>
                            </row>
                            <row>
                                <entry>0UBI</entry>
                                <entry>NewsTracker</entry>
                            </row>
                            <row>
                                <entry>0UBJ</entry>
                                <entry>Directors' Briefing NewsLetter</entry>
                            </row>
                            <row>
                                <entry>0UBL</entry>
                                <entry>Will Power NewsLetter</entry>
                            </row>
                            <row>
                                <entry>0UBN</entry>
                                <entry>Canadian Securities Law NewsTracker</entry>
                            </row>
                            <row>
                                <entry>0UBO</entry>
                                <entry>NewsTracker </entry>
                            </row>
                            <row>
                                <entry>0UBP</entry>
                                <entry>Employment Standards NewsTracker</entry>
                            </row>
                            <row>
                                <entry>0UBQ</entry>
                                <entry>Labour Law Cases NewsTracker</entry>
                            </row>
                            <row>
                                <entry>0UBR</entry>
                                <entry>NewsTracker</entry>
                            </row>
                            <row>
                                <entry>0UBT</entry>
                                <entry>Nouvelles Express</entry>
                            </row>
                            <row>
                                <entry>0UBU</entry>
                                <entry>Nouvelles Express</entry>
                            </row>
                            <row>
                                <entry>0UBV</entry>
                                <entry>Nouvelles Express - Droit corporatif</entry>
                            </row>
                            <row>
                                <entry>0UBW</entry>
                                <entry>Nouvelles Express - Charte et droit pénal</entry>
                            </row>
                            <row>
                                <entry>0UBX</entry>
                                <entry>Nouvelles Express - Emploi et droit du travail</entry>
                            </row>
                            <row>
                                <entry>0UBY</entry>
                                <entry>Nouvelles Express</entry>
                            </row>
                            <row>
                                <entry>0UCE</entry>
                                <entry>What’s New</entry>
                            </row>
                            <row>
                                <entry>0UCH</entry>
                                <entry>What's New</entry>
                            </row>
                            <row>
                                <entry>0UCQ</entry>
                                <entry>What’s New</entry>
                            </row>
                            <row>
                                <entry>0UDH</entry>
                                <entry>What’s New</entry>
                            </row>
                            <row>
                                <entry>0UEA</entry>
                                <entry>What's New</entry>
                            </row>
                            <row>
                                <entry>0UF9</entry>
                                <entry>Human Rights/Equity Issues What's New</entry>
                            </row>
                            <row>
                                <entry>0UFI</entry>
                                <entry>What's New</entry>
                            </row>
                            <row>
                                <entry>0UFP</entry>
                                <entry>What’s New</entry>
                            </row>
                            <row>
                                <entry>0UHY</entry>
                                <entry>Labour Relations What's New</entry>
                            </row>
                            <row>
                                <entry>0UMV</entry>
                                <entry>Mises à jour récentes</entry>
                            </row>
                            <row>
                                <entry>0UMW</entry>
                                <entry>Bulletin</entry>
                            </row>
                            <row>
                                <entry>0UN2</entry>
                                <entry>Mises à jour récentes</entry>
                            </row>
                            <row>
                                <entry>0UNB</entry>
                                <entry>Bulletin</entry>
                            </row>
                            <row>
                                <entry>0UNM</entry>
                                <entry>Mises à jour récentes</entry>
                            </row>
                            <row>
                                <entry>0UNT</entry>
                                <entry>Bulletin</entry>
                            </row>
                            <row>
                                <entry>0UNX</entry>
                                <entry>Mises à jour récentes</entry>
                            </row>
                            <row>
                                <entry>0UO0</entry>
                                <entry>Bulletin</entry>
                            </row>
                            <row>
                                <entry>0UO3</entry>
                                <entry>Mises à jour récentes</entry>
                            </row>
                            <row>
                                <entry>0UOH</entry>
                                <entry>Mises à jour récentes</entry>
                            </row>
                            <row>
                                <entry>0UON</entry>
                                <entry>Bulletin</entry>
                            </row>
                            <row>
                                <entry>0UOQ</entry>
                                <entry>Mises à jour récentes</entry>
                            </row>
                            <row>
                                <entry>0UOW</entry>
                                <entry>Bulletin</entry>
                            </row>
                            <row>
                                <entry>0UPS</entry>
                                <entry>What's New</entry>
                            </row>
                            <row>
                                <entry>0US4</entry>
                                <entry>Mises à jour récentes</entry>
                            </row>
                            <row>
                                <entry>0UT9</entry>
                                <entry>Mises à jour récentes</entry>
                            </row>
                            <row>
                                <entry>0UTF</entry>
                                <entry>Bulletin</entry>
                            </row>
                            <row>
                                <entry>0V16</entry>
                                <entry>What's New</entry>
                            </row>
                            <row>
                                <entry>0V5W</entry>
                                <entry>What’s New</entry>
                            </row>
                            <row>
                                <entry>0V61</entry>
                                <entry>What’s New</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <pre>
&lt;docinfo:metaitem name="DPSI"&gt;0V61&lt;/docinfo:metaitem&gt;
...
&lt;docinfo:hier&gt;
    &lt;docinfo:hierlev role="ancestor"&gt;
        &lt;heading&gt;
            &lt;title&gt;1950s&lt;/title&gt;
        &lt;/heading&gt;
        &lt;docinfo:hierlev role="ancestor"&gt;
            &lt;heading&gt;
                &lt;title&gt;1957&lt;/title&gt;
            &lt;/heading&gt;
            &lt;docinfo:hierlev role="me"&gt;
                &lt;heading&gt;
                    &lt;title&gt;[1957] I.L.R. para. 1-279 -- Gray v. Kerslake.&lt;/title&gt;
                &lt;/heading&gt;
            &lt;/docinfo:hierlev&gt;
        &lt;/docinfo:hierlev&gt;
    &lt;/docinfo:hierlev&gt;
&lt;/docinfo:hier&gt;
            </pre>
                <p>
                    <b>becomes</b>
                </p>
                <pre>
&lt;doc:hier&gt;
    &lt;doc:hierlev&gt;
        &lt;heading&gt;
            &lt;title&gt;What’s New&lt;/title&gt;
        &lt;/heading&gt;
        &lt;doc:hierlev&gt;
            &lt;heading&gt;
                &lt;title&gt;1950s&lt;/title&gt;
            &lt;/heading&gt;
            &lt;doc:hierlev&gt;
                &lt;heading&gt;
                    &lt;title&gt;1957&lt;/title&gt;
                &lt;/heading&gt;
                &lt;doc:hierlev&gt;
                    &lt;heading&gt;
                        &lt;title&gt;[1957] I.L.R. para. 1-279 -- Gray v. Kerslake.&lt;/title&gt;
                    &lt;/heading&gt;
                &lt;/doc:hierlev&gt;
            &lt;/doc:hierlev&gt;
        &lt;/doc:hierlev&gt;
    &lt;/doc:hierlev&gt;
&lt;/doc:hier&gt;
            </pre>
            </section>

            <section>
                <title>Change Log</title>
                <p>2016-07-27: <ph id="change_20160727_SS">Only change the language of existing rule
                        for handling the DPSI values inside the column of <b>'TOC top
                        line'</b>.</ph></p>
                <p>2016-07-20: <ph id="change_20160720_SS">Deleted and updated some DPSI values
                        inside the column <b>TOC top line</b>.</ph></p>
                <p>2016-04-26: <ph id="change_20160426_PS">Created.</ph></p>
            </section>
        </body>
    </dita:topic>

    <!--  @@@ This file has been autogenerated.  Remove this comment after manual development complete! @@@  -->
    <!--    Original DITA file location:  DITA\ConversionInstructions\Rosetta\DITA-CAN\CA14-Emerging_Issues\CA14_dpsi-stream-doc.hierlev-heading-title.dita  -->
    <!--<xsl:message>CA14_dpsi-stream-doc.hierlev-heading-title.xsl requires manual development!</xsl:message>-->

    <xsl:variable name="vDpsiCodes">
        <codes>
            <code key="0U90" value="What's New"/>
            <code key="0U93" value="Canadian Securities Law News NewsLetter"/>
            <code key="0U97" value="What’s New"/>
            <code key="0U9I" value="What’s New"/>
            <code key="0U9J" value="Health Law Matters NewsLetter"/>
            <code key="0U9K" value="What’s New"/>
            <code key="0U9N" value="Commercial Times NewsLetter"/>
            <code key="0UA1" value="Canadian Family Law Matters NewsLetter "/>
            <code key="0UAB" value="What’s New"/>
            <code key="0UAM" value="Canada Corporate Brief - NewsLetter"/>
            <code key="0UAU" value="Labour Law Cases What's New"/>
            <code key="0UAX" value="Employment Standards What's New"/>
            <code key="0UAZ" value="Employment Insurance What's New"/>
            <code key="0UB0" value="What's New"/>
            <code key="0UB2" value="What’s New"/>
            <code key="0UB3" value="Corporate Law NewsTracker"/>
            <code key="0UB4" value="Commercial Law NewsTracker"/>
            <code key="0UB5" value="Real Estate Law NewsTracker"/>
            <code key="0UB6" value="NewsLetter"/>
            <code key="0UB7" value="NewsLetter"/>
            <code key="0UB8" value="What’s New"/>
            <code key="0UBB" value="BC Real Estate Law Developments NewsLetter"/>
            <code key="0UBC" value="Labour Notes Newsletter"/>
            <code key="0UBD" value="NewsTracker"/>
            <code key="0UBE" value="Ontario Real Estate Law Developments NewsLetter"/>
            <code key="0UBG" value="Newsletter"/>
            <code key="0UBH" value="NewsLetter"/>
            <code key="0UBI" value="NewsTracker"/>
            <code key="0UBJ" value="Directors' Briefing NewsLetter"/>
            <code key="0UBL" value="Will Power NewsLetter"/>
            <code key="0UBN" value="Canadian Securities Law NewsTracker"/>
            <code key="0UBO" value="NewsTracker "/>
            <code key="0UBP" value="Employment Standards NewsTracker"/>
            <code key="0UBQ" value="Labour Law Cases NewsTracker"/>
            <code key="0UBR" value="NewsTracker"/>
            <code key="0UBT" value="Nouvelles Express"/>
            <code key="0UBU" value="Nouvelles Express"/>
            <code key="0UBV" value="Nouvelles Express - Droit corporatif"/>
            <code key="0UBW" value="Nouvelles Express - Charte et droit pénal"/>
            <code key="0UBX" value="Nouvelles Express - Emploi et droit du travail"/>
            <code key="0UBY" value="Nouvelles Express"/>
            <code key="0UCE" value="What’s New"/>
            <code key="0UCH" value="What's New"/>
            <code key="0UCQ" value="What’s New"/>
            <code key="0UDH" value="What’s New"/>
            <code key="0UEA" value="What's New"/>
            <code key="0UF9" value="Human Rights/Equity Issues What's New"/>
            <code key="0UFI" value="What's New"/>
            <code key="0UFP" value="What’s New"/>
            <code key="0UHY" value="Labour Relations What's New"/>
            <code key="0UMV" value="Mises à jour récentes"/>
            <code key="0UMW" value="Bulletin"/>
            <code key="0UN2" value="Mises à jour récentes"/>
            <code key="0UNB" value="Bulletin"/>
            <code key="0UNM" value="Mises à jour récentes"/>
            <code key="0UNT" value="Bulletin"/>
            <code key="0UNX" value="Mises à jour récentes"/>
            <code key="0UO0" value="Bulletin"/>
            <code key="0UO3" value="Mises à jour récentes"/>
            <code key="0UOH" value="Mises à jour récentes"/>
            <code key="0UON" value="Bulletin"/>
            <code key="0UOQ" value="Mises à jour récentes"/>
            <code key="0UOW" value="Bulletin"/>
            <code key="0UPS" value="What's New"/>
            <code key="0US4" value="Mises à jour récentes"/>
            <code key="0UT9" value="Mises à jour récentes"/>
            <code key="0UTF" value="Bulletin"/>
            <code key="0V16" value="What's New"/>
            <code key="0V5W" value="What’s New"/>
            <code key="0V61" value="What’s New"/>
        </codes>
    </xsl:variable>

    <xsl:key name="KCodes" match="*:code" use="string(@key)"/>

    <!-- @Vikas Rohilla: Template to match the docinfo:hier for the $streamID ='CA14' 	-->
    <xsl:template match="docinfo:hier[$streamID = 'CA14']">
        <xsl:variable name="top_title">
            <xsl:value-of select="key('KCodes', $dpsi, $vDpsiCodes)/@value"/>
        </xsl:variable>
        <xsl:element name="doc:hier">
            <xsl:choose>
                <xsl:when test="$top_title!=''">
                    <xsl:element name="doc:hierlev">
                        <xsl:element name="heading">
                            <xsl:element name="title">
                                <xsl:value-of select="$top_title"/>
                            </xsl:element>
                        </xsl:element>
                        <xsl:apply-templates select="node() | @*"/>
                    </xsl:element>    
                </xsl:when>
                <xsl:otherwise>
                    <xsl:apply-templates select="node() | @*"/>
                </xsl:otherwise>
            </xsl:choose>   
        </xsl:element>
    </xsl:template>
</xsl:stylesheet>
