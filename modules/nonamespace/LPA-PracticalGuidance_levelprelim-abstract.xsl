<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns="http://www.lexisnexis.com/xmlschemas/content/shared/base/1/"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:comm="http://www.lexis-nexis.com/glp/comm"
  xmlns:dita="http://dita.oasis-open.org/architecture/2005/"
  xmlns:seclaw="http://www.lexisnexis.com/xmlschemas/content/legal/secondary-law/1/" version="2.0"
  exclude-result-prefixes="dita">

  <dita:topic xmlns="http://dita.oasis-open.org/architecture/2005/" id="USLPA_levelprelim-abstract">
    <title>levelprelim and abstract <lnpid>id-CCCCTBA</lnpid></title>
    <body>
      <section>
        <title>Instructions</title>
        <p><sourcexml>levelprelim</sourcexml> becomes <targetxml>seclaw:prelim</targetxml>.</p>
        <p>Child <sourcexml>abstract</sourcexml> becomes
          <targetxml>abstract/bodytext</targetxml>.</p>
      </section>
      <example>
        <title>SOURCE XML</title>
        <codeblock> &lt;COMMENTARYDOC&gt; &lt;comm:body&gt; &lt;level leveltype="topic"&gt;
          &lt;heading&gt; &lt;title&gt;Business Interests - overview&lt;/title&gt; &lt;/heading&gt;
          &lt;levelprelim&gt; &lt;abstract&gt; &lt;p&gt; &lt;text&gt;This document is an overview
          of...&lt;/text&gt; &lt;/p&gt; &lt;/abstract&gt; &lt;/levelprelim&gt; &lt;bodytext&gt;
          &lt;p&gt; &lt;text&gt;In the US, the legislation governing...&lt;/text&gt; &lt;/p&gt;
          &lt;/bodytext&gt; &lt;/level&gt; &lt;/comm:body&gt; &lt;/COMMENTARYDOC&gt; </codeblock>
      </example>
      <example>
        <title>TARGET XML</title>
        <codeblock> &lt;seclaw:seclaw&gt; &lt;seclaw:body&gt; &lt;seclaw:level leveltype="topic"&gt;
          &lt;heading&gt; &lt;title&gt;Business Interests - overview&lt;/title&gt; &lt;/heading&gt;
          &lt;seclaw:prelim&gt; &lt;abstract&gt; &lt;bodytext&gt; &lt;p&gt; &lt;text&gt;This
          document is an overview of...&lt;/text&gt; &lt;/p&gt; &lt;/bodytext&gt; &lt;/abstract&gt;
          &lt;/seclaw:prelim&gt; &lt;seclaw:bodytext&gt; &lt;p&gt; &lt;text&gt;In the US, the
          legislation governing...&lt;/text&gt; &lt;/p&gt; &lt;/seclaw:bodytext&gt;
          &lt;/seclaw:level&gt; &lt;/seclaw:body&gt; &lt;/seclaw:seclaw&gt; </codeblock>
      </example>
    </body>
  </dita:topic>

  <!--  @@@ This file has been autogenerated.  Remove this comment after manual development complete! @@@  -->
  <!--    Original DITA file location:  DITA\ConversionInstructions\Rosetta\DITA-US\US_LPA\LPA-PracticalGuidance_levelprelim-abstract.dita  -->
  <!--<xsl:message>LPA-PracticalGuidance_levelprelim-abstract.xsl requires manual development!</xsl:message> 
-->
  <xsl:template match="levelprelim">

    <!--  Original Target XPath:  seclaw:prelim   -->
    <xsl:choose>
      <xsl:when test="preceding::comm:info/contrib/note[not(preceding::comm:info/contrib/note)]">
        <xsl:apply-templates select="@* | node()"/>
      </xsl:when>
      <xsl:otherwise>
        <seclaw:prelim>
          <xsl:apply-templates select="@* | node()"/>
        </seclaw:prelim>
        <!-- SNB 2018-01-19 Webstar_7091986 : need to move copy of following level processing from the bodytext processing mentioned 
               in comment below to be INSIDE XSL:CHOOSE so that only happens if seclaw:prelim was opened AND closed first. 
               for case where prelim wasnt closed, will need to add following level process to other location where ...
               preceding::comm:info/contrib/note[not(preceding::comm:info/contrib/note)] was being processed because that 
               should be where prelim gets closed -->
        <!-- SNB 2017-12-12 Add copy of following level processing from the bodytext processing in case 
                no bodytext exists for webstar 7060631 fix (wouldnt work when no bodytext before levels) -->
        <xsl:if test="following-sibling::level and not(following-sibling::bodytext)">
          <seclaw:bodytext>
            <xsl:apply-templates select="following-sibling::level" mode="bodytext_wrapper"/>
          </seclaw:bodytext>
        </xsl:if>
      </xsl:otherwise>
    </xsl:choose>
  </xsl:template>

  <xsl:template match="abstract">

    <!--  Original Target XPath:  abstract/bodytext   -->
    <abstract>
      <bodytext>
        <xsl:apply-templates select="child::p" mode="abstract"></xsl:apply-templates>
      </bodytext>
    </abstract>

  </xsl:template>
  
  <xsl:template match="abstract/p" mode="abstract">
    <p>
    <xsl:apply-templates select="child::text" mode="abstarct_text"/>  
    </p>
  </xsl:template>
  
 <xsl:template match="p/text" mode="abstarct_text">
   <text>
     <xsl:apply-templates select="@* | node()"/>
   </text>
 </xsl:template>
  
</xsl:stylesheet>
